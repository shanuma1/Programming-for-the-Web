<!doctype html>
<html lang='en-US'>
<head>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="../../assets/styles/article.css" rel="stylesheet" type="text/css" />
  <title>CS 544: Javascript Introduction</title>
<link href="js-intro/hl-fine_blue.css" rel="stylesheet"/>
</head>
<body>
    <nav>
      <ul>
	<li><a href="../../index.html" class="material-icons">house</a></li>
	<li><a href="../../docs/index.html">Docs</a></li>
	<li><a href="../../exams-quizzes/index.html">Exams &amp; Quizzes</a></li>
	<li><a href="../../exercises/index.html">Exercises</a></li>
	<li><a href="../../hws/index.html">Homeworks</a></li>
	<li><a href="../../misc/index.html">Misc</a></li>
	<li><a href="../../projects/index.html">Projects</a></li>
	<li><a href="../../slides/index.html">Slides</a></li>
	<li><a id="loginAction"></a></li>
      </ul>
    </nav>
  <div class="slide-controls" style="display: none;">
    <span class="float-left">
      <span class="first-control">
	<a href="#">
	  <img src="../../assets/images/go-first.png">
	</a>
      </span>
      <span class="previous-control">
	<a href="#">
	  <img src="../../assets/images/go-previous.png">
	</a>
      </span>
    </span>
    <span class="float-right">
      <span class="next-control">
	<a href="#">
	  <img src="../../assets/images/go-next.png">
	</a>
      </span>
      <span class="last-control">
	<a href="#">
	  <img src="../../assets/images/go-last.png">
	</a>
      </span>
    </span>
    <div class="slide-end">&nbsp;<br></div> <!-- hack -->
  </div>
<div class="content">
<section data-coord="js-intro.umt:1:0"><h1 data-coord="js-intro.umt:1:0">Javascript Introduction</h1><section class="umt-slide" data-coord="js-intro.umt:3:0"><h2 data-coord="js-intro.umt:3:0">Overview</h2><ul data-coord="js-intro.umt:6:0"><li data-coord="js-intro.umt:6:0"><p data-coord="js-intro.umt:6:4">History.
</p></li><li data-coord="js-intro.umt:8:0"><p data-coord="js-intro.umt:8:4">A practical example illustrating various features.
</p></li></ul></section><section class="umt-slide" data-coord="js-intro.umt:11:0"><h2 data-coord="js-intro.umt:11:0">Brief History</h2><ul data-coord="js-intro.umt:14:0"><li data-coord="js-intro.umt:14:0"><p data-coord="js-intro.umt:14:4">Written by Brendan Eich within 10 days in May, 1995 at Netscape
Communications.  Name chosen based on marketing considerations
to cash in on the popularity of Java.
</p></li><li data-coord="js-intro.umt:18:0"><p data-coord="js-intro.umt:18:4">Microsoft released <samp data-coord="js-intro.umt:18:23">jscript</samp> in 1996.  Incompatibilities
introduced ("embrace and extend").
</p></li><li data-coord="js-intro.umt:21:0"><p data-coord="js-intro.umt:21:4">Standardized as <samp data-coord="js-intro.umt:21:20">EcmaScript</samp>  in June 1997  (ECMA-262).
</p></li><li data-coord="js-intro.umt:23:0"><p data-coord="js-intro.umt:23:4">JavaScript got a bad reputation and was regarded as a poor
programming language used for doing trivial things in the browser.
Complexities caused by browser incompatibilities and the browser
<strong data-coord="js-intro.umt:23:207">Document Object Model</strong> (DOM) were blamed on the language.
</p></li><li data-coord="js-intro.umt:28:0"><p data-coord="js-intro.umt:28:4">Changed with the emergence of <strong data-coord="js-intro.umt:28:34">Asynchronous JAvascript with Xml</strong>
(AJAX) in 2005.
</p></li></ul></section><section class="umt-slide" data-coord="js-intro.umt:31:0"><h2 data-coord="js-intro.umt:31:0">Brief History Continued</h2><ul data-coord="js-intro.umt:34:0"><li data-coord="js-intro.umt:34:0"><p data-coord="js-intro.umt:34:4"><strong data-coord="js-intro.umt:34:4">JavaScript Object Notation</strong> (JSON) popularized by Douglas
Crockford emerged as a popular alternative to XML as a
specification for data interchange between heterogeneous systems.
</p></li><li data-coord="js-intro.umt:38:0"><p data-coord="js-intro.umt:38:4">Renaissance in js development.  Browser incompatibilities and DOM
complexities hidden by the use of libraries like <samp data-coord="js-intro.umt:38:123">prototype</samp>,
<samp data-coord="js-intro.umt:38:140">jquery</samp> and <samp data-coord="js-intro.umt:38:153">dojo</samp>.
</p></li><li data-coord="js-intro.umt:42:0"><p data-coord="js-intro.umt:42:4"><samp data-coord="js-intro.umt:42:4">Node.js</samp> released by Ryan Dahl in 2009.  Popularized the
use of js on the server.
</p></li><li data-coord="js-intro.umt:45:0"><p data-coord="js-intro.umt:45:4">Succession of different ECMA standards: es 3, es 5.  Currently,
evolving as an "evergreen" language with standard updates being
released yearly: es 2015 ... 2019.
</p></li><li data-coord="js-intro.umt:49:0"><p data-coord="js-intro.umt:49:4">Allows use of a single programming language across the entire web
stack.  Most popular programming language in terms of deployments.
</p></li></ul></section><section class="umt-slide" data-coord="js-intro.umt:53:0"><h2 data-coord="js-intro.umt:53:0">Language Overview</h2><ul data-coord="js-intro.umt:56:0"><li data-coord="js-intro.umt:56:0"><p data-coord="js-intro.umt:56:4">Object-based scripting language.
</p></li><li data-coord="js-intro.umt:58:0"><p data-coord="js-intro.umt:58:4">Also a functional programming language.
</p></li><li data-coord="js-intro.umt:60:0"><p data-coord="js-intro.umt:60:4">Dynamically typed: variables are untyped, but values have types.
Permits the use of <strong data-coord="js-intro.umt:60:92">duck typing</strong>.
</p></li><li data-coord="js-intro.umt:63:0"><p data-coord="js-intro.umt:63:4">Initially interpreted, now compiled using techniques like
runtime compilation.
</p></li><li data-coord="js-intro.umt:66:0"><p data-coord="js-intro.umt:66:4">Possible to evaluate strings representing code at runtime using
<samp data-coord="js-intro.umt:66:72">eval()</samp>.
</p></li><li data-coord="js-intro.umt:69:0"><p data-coord="js-intro.umt:69:4">Allows programming using multiple paradigms: procedural,
object-oriented, functional.
</p></li><li data-coord="js-intro.umt:72:0"><p data-coord="js-intro.umt:72:4">Borrows concepts from Scheme, Perl and Self.
</p></li><li data-coord="js-intro.umt:74:0"><p data-coord="js-intro.umt:74:4">Standard library is highly asynchronous.
</p></li></ul></section><section class="umt-slide" data-coord="js-intro.umt:77:0"><h2 data-coord="js-intro.umt:77:0">JavaScript Platforms</h2><p data-coord="js-intro.umt:80:0">Two main platforms on which JavaScript runs:
</p><ol data-coord="js-intro.umt:82:0"><li data-coord="js-intro.umt:82:0"><p data-coord="js-intro.umt:82:4"><strong data-coord="js-intro.umt:82:4">Browser</strong>: Platform provides interfaces to browser technologies
like the <em data-coord="js-intro.umt:82:81">Document Object Model</em> DOM and storage.
</p></li><li data-coord="js-intro.umt:85:0"><p data-coord="js-intro.umt:85:4"><strong data-coord="js-intro.umt:85:4">Server</strong>: Exemplified by <samp data-coord="js-intro.umt:85:29">nodejs</samp>.  Platform provides access to
filesystem, processes, etc.
</p></li></ol></section><section class="umt-slide" data-coord="js-intro.umt:88:0"><h2 data-coord="js-intro.umt:88:0">Example Program</h2><ul data-coord="js-intro.umt:91:0"><li data-coord="js-intro.umt:91:0"><p data-coord="js-intro.umt:91:4">Non-trivial program to grep one-or-more files.
</p></li><li data-coord="js-intro.umt:93:0"><p data-coord="js-intro.umt:93:4">Command-line nodejs program.
</p></li><li data-coord="js-intro.umt:95:0"><p data-coord="js-intro.umt:95:4">Invoked with arguments specifying regex and one-or-more files.
</p></li><li data-coord="js-intro.umt:97:0"><p data-coord="js-intro.umt:97:4">Both synchronous and asynchronous versions.
</p></li></ul></section><section class="umt-slide" data-coord="js-intro.umt:100:0"><h2 data-coord="js-intro.umt:100:0">Edited Log of Operation</h2><pre data-coord="js-intro.umt:104:0">$ ./sync-grep.mjs 
(node:12501) ExperimentalWarning: The ESM module loader is experimental.
usage: sync-grep.mjs REGEX FILE...
$ NODE_NO_WARNINGS=1 ./sync-grep.mjs '\' sync-grep.mjs 
bad regex \: Invalid regular expression: /\/: \ at end of pattern
$ NODE_NO_WARNINGS=1 ./sync-grep.mjs '\[\d\]' sync-grep.mjs 
sync-grep.mjs:17: 	  Path.basename(process.argv[1])); //@basename
sync-grep.mjs:21:     regex = new RegExp(process.argv[2]);
sync-grep.mjs:24:     abort("bad regex %s: %s", process.argv[2],
$ NODE_NO_WARNINGS=1 ./sync-grep.mjs '\[\d\]' \
                     sync-grep.mjs x
sync-grep.mjs:17: 	  Path.basename(process.argv[1])); //@basename
sync-grep.mjs:21:     regex = new RegExp(process.argv[2]);
sync-grep.mjs:24:     abort("bad regex %s: %s", process.argv[2],
cannot read x: ENOENT: no such file or directory, open 'x'
$
</pre></section><section class="umt-slide" data-coord="js-intro.umt:123:0"><h2 data-coord="js-intro.umt:123:0">Code for Synchronous Grep</h2><p data-coord="js-intro.umt:126:0">In <a href="code/sync-grep.mjs?colorize=true" data-coord="js-intro.umt:126:39">sync-grep.mjs:</a>
</p><pre><span class="hl opt">#!</span><span class="hl kwc">/usr/</span>bin<span class="hl opt">/</span>env node

<span class="hl kwa">import</span> fs <span class="hl kwa">from</span> <span class="hl str">&apos;fs&apos;</span><span class="hl opt">;</span> <span class="hl slc">//&#64;modules</span>
<span class="hl kwa">import</span> Path <span class="hl kwa">from</span> <span class="hl str">&apos;path&apos;</span><span class="hl opt">;</span>
<span class="hl kwa">import</span> process <span class="hl kwa">from</span> <span class="hl str">&apos;process&apos;</span><span class="hl opt">;</span>

<span class="hl kwa">function</span> <span class="hl kwd">abort</span><span class="hl opt">() {</span>
  <span class="hl slc">//&#64;complex</span>
  console<span class="hl opt">.</span><span class="hl kwd">error</span><span class="hl opt">(...</span>Array<span class="hl opt">.</span><span class="hl kwa">prototype</span><span class="hl opt">.</span>slice<span class="hl opt">.</span><span class="hl kwd">call</span><span class="hl opt">(</span>arguments<span class="hl opt">));</span>
  process<span class="hl opt">.</span><span class="hl kwd">exit</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">);</span>
<span class="hl opt">}</span>
</pre></section><section class="umt-slide" data-coord="js-intro.umt:130:0"><h2 data-coord="js-intro.umt:130:0">Commentary on Previous Code</h2><dl data-coord="js-intro.umt:133:0"><dt data-coord="js-intro.umt:133:2">First Line</dt><dd data-coord="js-intro.umt:134:0"><p data-coord="js-intro.umt:134:4">On Unix systems, a line starting with <em data-coord="js-intro.umt:134:42">hash-bang</em> <samp data-coord="js-intro.umt:134:54">#!</samp> specifies
running the file through an interpreter.  In this case, the
interpreter is the <samp data-coord="js-intro.umt:134:156">env</samp> program which runs its argument <samp data-coord="js-intro.umt:134:194">nodejs</samp>
with a specified environment. In this case no additional
environment is specified; the <samp data-coord="js-intro.umt:134:298">env</samp> program is merely used to find
<samp data-coord="js-intro.umt:134:339">nodejs</samp> on the user's <samp data-coord="js-intro.umt:134:362">PATH</samp>.
</p></dd><dt data-coord="js-intro.umt:141:2">@modules</dt><dd data-coord="js-intro.umt:142:0"><p data-coord="js-intro.umt:142:4">Inclusion of standard modules.  <samp data-coord="js-intro.umt:142:36">import</samp> is a new JavaScript
feature which has just made it in to nodejs.
</p></dd></dl></section><section class="umt-slide" data-coord="js-intro.umt:145:0"><h2 data-coord="js-intro.umt:145:0">Commentary on Previous Code Continued</h2><p data-coord="js-intro.umt:148:0">There is a lot worth noting in the single line following <samp data-coord="js-intro.umt:148:57">@complex</samp>:
</p><ul data-coord="js-intro.umt:150:0"><li data-coord="js-intro.umt:150:0"><p data-coord="js-intro.umt:150:4"><samp data-coord="js-intro.umt:150:4">console.error()</samp> (and <samp data-coord="js-intro.umt:150:27">console.log()</samp>) take printf-style
parameters; i.e. a message which may contain <samp data-coord="js-intro.umt:150:111">%</samp> format-specifiers
followed by args for the format-specifiers. So for example,
<samp data-coord="js-intro.umt:150:201">console.log('hello %s', 'world')</samp> would print <samp data-coord="js-intro.umt:150:248">hello world</samp>.
</p></li><li data-coord="js-intro.umt:155:0"><p data-coord="js-intro.umt:155:4">The pseudo-variable <samp data-coord="js-intro.umt:155:24">arguments</samp> always contains the arguments
of the current function.  This acts like an <samp data-coord="js-intro.umt:155:114">Array</samp> in some
contexts but is not a real <samp data-coord="js-intro.umt:155:161">Array</samp>.
</p></li><li data-coord="js-intro.umt:159:0"><p data-coord="js-intro.umt:159:4">The <samp data-coord="js-intro.umt:159:8">Array.prototype.slice()</samp> is used to convert <samp data-coord="js-intro.umt:159:53">arguments</samp> to
a true array.
</p></li><li data-coord="js-intro.umt:162:0"><p data-coord="js-intro.umt:162:4">The <samp data-coord="js-intro.umt:162:8">...</samp> spread operator spreads the true arguments array into
the parameters for <samp data-coord="js-intro.umt:162:91">console.error()</samp>.
</p></li></ul></section><section class="umt-slide" data-coord="js-intro.umt:166:0"><h2 data-coord="js-intro.umt:166:0">Code for Synchronous Grep Continued</h2><pre>
<span class="hl kwa">function</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
  <span class="hl kwa">if</span> <span class="hl opt">(</span>process<span class="hl opt">.</span>argv<span class="hl opt">.</span>length <span class="hl opt">&lt;</span> <span class="hl num">4</span><span class="hl opt">) {</span> <span class="hl slc">//&#64;argv</span>
    <span class="hl kwd">abort</span><span class="hl opt">(</span><span class="hl str">&apos;usage: %s REGEX FILE...&apos;</span><span class="hl opt">,</span> 
          Path<span class="hl opt">.</span><span class="hl kwd">basename</span><span class="hl opt">(</span>process<span class="hl opt">.</span>argv<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">]));</span> <span class="hl slc">//&#64;basename</span>
  <span class="hl opt">}</span>
  <span class="hl kwa">let</span> regex<span class="hl opt">;</span> <span class="hl slc">//&#64;let</span>
  <span class="hl kwa">try</span> <span class="hl opt">{</span>
    regex <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">RegExp</span><span class="hl opt">(</span>process<span class="hl opt">.</span>argv<span class="hl opt">[</span><span class="hl num">2</span><span class="hl opt">]);</span>
  <span class="hl opt">}</span>
  <span class="hl kwa">catch</span><span class="hl opt">(</span>err<span class="hl opt">) {</span>
    <span class="hl kwd">abort</span><span class="hl opt">(</span><span class="hl str">&quot;bad regex %s: %s&quot;</span><span class="hl opt">,</span> process<span class="hl opt">.</span>argv<span class="hl opt">[</span><span class="hl num">2</span><span class="hl opt">],</span>
          err<span class="hl opt">.</span>message<span class="hl opt">);</span>
  <span class="hl opt">}</span>
  <span class="hl kwd">grep</span><span class="hl opt">(</span>regex<span class="hl opt">,</span> process<span class="hl opt">.</span>argv<span class="hl opt">.</span><span class="hl kwd">slice</span><span class="hl opt">(</span><span class="hl num">3</span><span class="hl opt">));</span>
<span class="hl opt">}</span>
</pre></section><section class="umt-slide" data-coord="js-intro.umt:171:0"><h2 data-coord="js-intro.umt:171:0">Commentary on Previous Code</h2><dl data-coord="js-intro.umt:174:0"><dt data-coord="js-intro.umt:174:2">@argv</dt><dd data-coord="js-intro.umt:175:0"><p data-coord="js-intro.umt:175:4"><samp data-coord="js-intro.umt:175:4">process.argv[]</samp> contains the program's command-line arguments.
<samp data-coord="js-intro.umt:175:72">argv[0]</samp> contains the path to the interpreter, i.e. the path
to the <samp data-coord="js-intro.umt:175:145">nodejs</samp> executable; <samp data-coord="js-intro.umt:175:166">argv[1]</samp> contains the path of
the JavaScript file being run, i.e. the path to <samp data-coord="js-intro.umt:175:249">sync-grep.mjs</samp>
file.  The remaining arguments are the actual arguments
provided to the program. In this case, a <samp data-coord="js-intro.umt:175:370">REGEX</samp> and at least
one <samp data-coord="js-intro.umt:175:399">FILE</samp> name argument are required.
</p></dd><dt data-coord="js-intro.umt:183:2">@let</dt><dd data-coord="js-intro.umt:184:0"><p data-coord="js-intro.umt:184:4">The modern way of declaring variables in JavaScript is using <samp data-coord="js-intro.umt:184:65">let</samp>.
Does not have the surprises associated with the older <samp data-coord="js-intro.umt:184:130">var</samp> declarations.
</p></dd><dt data-coord="js-intro.umt:187:2">@basename</dt><dd data-coord="js-intro.umt:188:0"><p data-coord="js-intro.umt:188:5">Returns the last component of its path parameter.
</p></dd></dl></section><section class="umt-slide" data-coord="js-intro.umt:190:0"><h2 data-coord="js-intro.umt:190:0">Code for Synchronous Grep Continued</h2><pre>
<span class="hl kwa">function</span> <span class="hl kwd">grep</span><span class="hl opt">(</span>regex<span class="hl opt">,</span> files<span class="hl opt">) {</span> 
  <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwa">const</span> file <span class="hl kwa">of</span> files<span class="hl opt">) {</span> <span class="hl slc">//&#64;for-of</span>
    <span class="hl kwa">try</span> <span class="hl opt">{</span>
      <span class="hl kwa">const</span> contents <span class="hl opt">=</span> fs<span class="hl opt">.</span><span class="hl kwd">readFileSync</span><span class="hl opt">(</span>file<span class="hl opt">).</span><span class="hl kwd">toString</span><span class="hl opt">();</span>
      <span class="hl kwa">let</span> lineN <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>
      <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwa">const</span> line <span class="hl kwa">of</span> contents<span class="hl opt">.</span><span class="hl kwd">split</span><span class="hl opt">(</span><span class="hl str">&apos;</span><span class="hl esc">\n</span><span class="hl str">&apos;</span><span class="hl opt">)) {</span>
        <span class="hl kwa">if</span> <span class="hl opt">(</span>line<span class="hl opt">.</span><span class="hl kwd">match</span><span class="hl opt">(</span>regex<span class="hl opt">)) {</span> <span class="hl slc">//&#64;regex</span>
          console<span class="hl opt">.</span><span class="hl kwd">log</span><span class="hl opt">(</span><span class="hl str">&quot;%s:%i: %s&quot;</span><span class="hl opt">,</span> file<span class="hl opt">,</span> lineN<span class="hl opt">,</span> line<span class="hl opt">);</span>
        <span class="hl opt">}</span>
        lineN<span class="hl opt">++;</span>
      <span class="hl opt">}</span>
    <span class="hl opt">}</span></pre></section><section class="umt-slide" data-coord="js-intro.umt:195:0"><h2 data-coord="js-intro.umt:195:0">Code for Synchronous Grep Continued</h2><pre>
    <span class="hl kwa">catch</span> <span class="hl opt">(</span>err<span class="hl opt">) {</span> <span class="hl slc">//&#64;exception</span>
      console<span class="hl opt">.</span><span class="hl kwd">error</span><span class="hl opt">(</span><span class="hl str">&quot;cannot read %s: %s&quot;</span><span class="hl opt">,</span> file<span class="hl opt">,</span>
                    err<span class="hl opt">.</span>message<span class="hl opt">);</span>
    <span class="hl opt">}</span>
  <span class="hl opt">}</span> <span class="hl slc">//for</span>
<span class="hl opt">}</span> <span class="hl slc">//grep()</span>

<span class="hl kwd">main</span><span class="hl opt">();</span></pre></section><section class="umt-slide" data-coord="js-intro.umt:200:0"><h2 data-coord="js-intro.umt:200:0">Commentary on Previous Code</h2><dl data-coord="js-intro.umt:203:0"><dt data-coord="js-intro.umt:203:2">@for-of</dt><dd data-coord="js-intro.umt:204:0"><p data-coord="js-intro.umt:204:4">The modern way to loop through elements of an array in order
is <code><span class="hl kwa">for</span> <span class="hl opt">(</span>variable <span class="hl kwa">of</span> array<span class="hl opt">) { ... }</span></code>
</p></dd><dt data-coord="js-intro.umt:207:2">@regex</dt><dd data-coord="js-intro.umt:208:0"><p data-coord="js-intro.umt:208:4"><samp data-coord="js-intro.umt:208:4">line.match(regex)</samp> returns "true" iff some contents in
<samp data-coord="js-intro.umt:208:65">line</samp> matched the regular expression <samp data-coord="js-intro.umt:208:103">regex</samp>.
</p></dd><dt data-coord="js-intro.umt:211:2">@exception</dt><dd data-coord="js-intro.umt:212:0"><p data-coord="js-intro.umt:212:4">The <samp data-coord="js-intro.umt:212:8">catch</samp> will trigger if an exception occurs.  JavaScript
automatically scopes the <samp data-coord="js-intro.umt:212:94">err</samp> variable in <samp data-coord="js-intro.umt:212:112">catch(err)</samp> to
only the <samp data-coord="js-intro.umt:212:141">catch</samp>-block.
</p></dd></dl></section><section class="umt-slide" data-coord="js-intro.umt:217:0"><h2 data-coord="js-intro.umt:217:0">Asynchronous Code</h2><p data-coord="js-intro.umt:220:0">Most modern computer systems allow execution of code while waiting for
external events like I/O completion.  Some alternatives:
</p><ol data-coord="js-intro.umt:223:0"><li data-coord="js-intro.umt:223:0"><p data-coord="js-intro.umt:223:8">Blocking synchronous I/O with explicit concurrency constructs
like threads or processes.  Problems with synchronizing access
to shared data.
</p></li><li data-coord="js-intro.umt:227:0"><p data-coord="js-intro.umt:227:8">Asynchronous I/O with a single thread of execution with an
event loop which runs event handlers when events occur.  Each
event handler <strong data-coord="js-intro.umt:227:152">runs to completion</strong> before the next event handler
is run by the event loop.  Reduces synchronization problems;
no synchronization problems while an event handler is running but
need to handle synchronization between event handlers.
</p></li></ol><p data-coord="js-intro.umt:234:0">JavaScript prefers (2).
</p></section><section class="umt-slide" data-coord="js-intro.umt:237:0"><h2 data-coord="js-intro.umt:237:0">Asynchronous Grep</h2><ul data-coord="js-intro.umt:240:0"><li data-coord="js-intro.umt:240:0"><p data-coord="js-intro.umt:240:4">Only change from code for synchronous grep are the <samp data-coord="js-intro.umt:240:55">abort()</samp> and
<samp data-coord="js-intro.umt:240:73">grep()</samp> functions; rest of code is identical and not discussed
further.
</p></li><li data-coord="js-intro.umt:244:0"><p data-coord="js-intro.umt:244:4">When a file is open'd, it is passed a callback event handler which
should handle both success and failure of the open.  The <samp data-coord="js-intro.umt:244:132">open()</samp>
call will return immediately before the file is open'd; the event
handler will be run when the status of the file open is known.
</p></li><li data-coord="js-intro.umt:249:0"><p data-coord="js-intro.umt:249:4">The code uses nodejs's <samp data-coord="js-intro.umt:249:27">readline</samp> module.  Normally used for
reading from a terminal but can also be used to read from
files.
</p></li><li data-coord="js-intro.umt:253:0"><p data-coord="js-intro.umt:253:4">The code uses explicit callback event handlers for <samp data-coord="js-intro.umt:253:55">readline</samp>
completing reading of a line or encountering an error.
</p></li></ul></section><section class="umt-slide" data-coord="js-intro.umt:257:0"><h2 data-coord="js-intro.umt:257:0">Code for abort()</h2><p data-coord="js-intro.umt:260:0">In <a href="code/async-grep.mjs?colorize=true" data-coord="js-intro.umt:260:40">async-grep.mjs:</a>
</p><pre>
<span class="hl kwa">function</span> <span class="hl kwd">abort</span><span class="hl opt">(...</span>args<span class="hl opt">) {</span> <span class="hl slc">//&#64;rest-args</span>
  console<span class="hl opt">.</span><span class="hl kwd">error</span><span class="hl opt">(...</span>args<span class="hl opt">);</span> <span class="hl slc">//&#64;spread-args</span>
  process<span class="hl opt">.</span><span class="hl kwd">exit</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">);</span>
<span class="hl opt">}</span></pre><dl data-coord="js-intro.umt:264:0"><dt data-coord="js-intro.umt:264:2">@rest-args</dt><dd data-coord="js-intro.umt:265:0"><p data-coord="js-intro.umt:265:4">If last formal parameter is prefixed with a <samp data-coord="js-intro.umt:265:48">...</samp>, then that parameter's
will be an array.  In the example, <samp data-coord="js-intro.umt:265:116">...args</samp> will set <samp data-coord="js-intro.umt:265:135">args</samp> to an
array containing all the arguments to <samp data-coord="js-intro.umt:265:190">abort()</samp>.
</p></dd><dt data-coord="js-intro.umt:269:2">@spread-args</dt><dd data-coord="js-intro.umt:270:0"><p data-coord="js-intro.umt:270:4">If a variable which is an array is prefixed with a <samp data-coord="js-intro.umt:270:55">...</samp> in a
function call, then that array gets spread into the call such
that each element is a separate argument in the call.
</p></dd></dl></section><section class="umt-slide" data-coord="js-intro.umt:276:0"><h2 data-coord="js-intro.umt:276:0">Code for Asynchronous Grep</h2><pre>
<span class="hl kwa">function</span> <span class="hl kwd">grep</span><span class="hl opt">(</span>regex<span class="hl opt">,</span> files<span class="hl opt">) {</span>
  <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwa">const</span> file <span class="hl kwa">of</span> files<span class="hl opt">) {</span>
    fs<span class="hl opt">.</span><span class="hl kwd">open</span><span class="hl opt">(</span>file<span class="hl opt">,</span> <span class="hl str">&apos;r&apos;</span><span class="hl opt">,</span> <span class="hl kwa">function</span><span class="hl opt">(</span>err<span class="hl opt">,</span> fd<span class="hl opt">) {</span> <span class="hl slc">//&#64;open</span>
      <span class="hl kwa">if</span> <span class="hl opt">(</span>err<span class="hl opt">) {</span>
        console<span class="hl opt">.</span><span class="hl kwd">error</span><span class="hl opt">(</span><span class="hl str">&quot;cannot read file %s: %s&quot;</span><span class="hl opt">,</span>
                      file<span class="hl opt">,</span> err<span class="hl opt">.</span>message<span class="hl opt">);</span>
      <span class="hl opt">}</span>
      <span class="hl kwa">else</span> <span class="hl opt">{</span>
        <span class="hl kwa">const</span> rl <span class="hl opt">=</span> readline<span class="hl opt">.</span><span class="hl kwd">createInterface</span><span class="hl opt">({</span>
          input<span class="hl opt">:</span> fs<span class="hl opt">.</span><span class="hl kwd">createReadStream</span><span class="hl opt">(</span>file<span class="hl opt">, {</span>fd<span class="hl opt">:</span> fd<span class="hl opt">}),</span>
          crlfDelay<span class="hl opt">:</span> Infinity <span class="hl slc">//&#64;crlfDelay</span>
        <span class="hl opt">});</span></pre></section><section class="umt-slide" data-coord="js-intro.umt:281:0"><h2 data-coord="js-intro.umt:281:0">Code for Asynchronous Grep Continued</h2><pre>
        <span class="hl kwa">let</span> lineN <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>
        rl<span class="hl opt">.</span><span class="hl kwd">on</span><span class="hl opt">(</span><span class="hl str">&apos;line&apos;</span><span class="hl opt">, (</span>line<span class="hl opt">) =&gt; {</span> <span class="hl slc">//&#64;line</span>
          <span class="hl kwa">if</span> <span class="hl opt">(</span>line<span class="hl opt">.</span><span class="hl kwd">match</span><span class="hl opt">(</span>regex<span class="hl opt">)) {</span>
            console<span class="hl opt">.</span><span class="hl kwd">log</span><span class="hl opt">(</span><span class="hl str">&quot;%s:%i: %s&quot;</span><span class="hl opt">,</span>
                        file<span class="hl opt">,</span> lineN<span class="hl opt">,</span> line<span class="hl opt">);</span>
          <span class="hl opt">}</span>
          lineN<span class="hl opt">++;</span> <span class="hl slc">//&#64;closure</span>
        <span class="hl opt">});</span>
        rl<span class="hl opt">.</span><span class="hl kwd">on</span><span class="hl opt">(</span><span class="hl str">&apos;error&apos;</span><span class="hl opt">,</span> <span class="hl kwa">function</span><span class="hl opt">() {</span> <span class="hl slc">//&#64;error</span>
          console<span class="hl opt">.</span><span class="hl kwd">error</span><span class="hl opt">(</span><span class="hl str">&quot;cannot read %s: %s&quot;</span><span class="hl opt">,</span>
                        file<span class="hl opt">,</span> err<span class="hl opt">.</span>message<span class="hl opt">);</span>
        <span class="hl opt">});</span>
      <span class="hl opt">}</span>
    <span class="hl opt">});</span> <span class="hl slc">//fs.open()</span>
  <span class="hl opt">}</span> <span class="hl slc">//for          </span>
<span class="hl opt">}</span> <span class="hl slc">//grep()</span></pre></section><section class="umt-slide" data-coord="js-intro.umt:286:0"><h2 data-coord="js-intro.umt:286:0">Commentary on Previous Code</h2><dl data-coord="js-intro.umt:289:0"><dt data-coord="js-intro.umt:289:2">@open</dt><dd data-coord="js-intro.umt:290:0"><p data-coord="js-intro.umt:290:4">The callback takes two arguments: an error object <samp data-coord="js-intro.umt:290:54">err</samp> which
is "true" if the open fails and a file descriptor <samp data-coord="js-intro.umt:290:121">fd</samp> which
will contain a descriptor for the file if the <samp data-coord="js-intro.umt:290:182">open()</samp> succeeds.
Note the use of an anonymous function to specify the callback.
</p></dd><dt data-coord="js-intro.umt:295:2">@crlfDelay</dt><dd data-coord="js-intro.umt:296:0"><p data-coord="js-intro.umt:296:4">If the time interval between input of a <samp data-coord="js-intro.umt:296:44">'\r'</samp> and <samp data-coord="js-intro.umt:296:55">'\n'</samp> is less than
the value of this parameter, they will be collapsed into a single
<samp data-coord="js-intro.umt:296:149">'\n'</samp> character.
</p></dd><dt data-coord="js-intro.umt:300:2">@line</dt><dd data-coord="js-intro.umt:301:0"><p data-coord="js-intro.umt:301:4">The <samp data-coord="js-intro.umt:301:8">'line'</samp> event fires for each line read and the event
handler is run.  Note the use of JavaScript's fat-arrow
notation to specify the callback.
</p></dd><dt data-coord="js-intro.umt:305:2">@closure</dt><dd data-coord="js-intro.umt:306:0"><p data-coord="js-intro.umt:306:4">The <samp data-coord="js-intro.umt:306:8">lineN++</samp> within the callback is referring to the <samp data-coord="js-intro.umt:306:58">lineN</samp>
variable defined outside the callback.  It is able to do so
because JavaScript supports <em data-coord="js-intro.umt:306:162">closures</em>.
</p></dd><dt data-coord="js-intro.umt:310:2">@error</dt><dd data-coord="js-intro.umt:311:0"><p data-coord="js-intro.umt:311:4">The <samp data-coord="js-intro.umt:311:8">'error'</samp> event fires if an error is occurred while
reading a line.
</p></dd></dl></section></section>
</div> <!-- #content -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="../../assets/scripts/slide-controls.js"></script>
<script src="../../assets/scripts/loginAction.js"></script>
</body>
</html>
