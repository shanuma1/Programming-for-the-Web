<!doctype html>
<html lang='en-US'>
<head>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="../../assets/styles/article.css" rel="stylesheet" type="text/css" />
  <title>CS 544: Modules</title>
<link href="modules/hl-fine_blue.css" rel="stylesheet"/>
</head>
<body>
    <nav>
      <ul>
	<li><a href="../../index.html" class="material-icons">house</a></li>
	<li><a href="../../docs/index.html">Docs</a></li>
	<li><a href="../../exams-quizzes/index.html">Exams &amp; Quizzes</a></li>
	<li><a href="../../exercises/index.html">Exercises</a></li>
	<li><a href="../../hws/index.html">Homeworks</a></li>
	<li><a href="../../misc/index.html">Misc</a></li>
	<li><a href="../../projects/index.html">Projects</a></li>
	<li><a href="../../slides/index.html">Slides</a></li>
	<li><a id="loginAction"></a></li>
      </ul>
    </nav>
  <div class="slide-controls" style="display: none;">
    <span class="float-left">
      <span class="first-control">
	<a href="#">
	  <img src="../../assets/images/go-first.png">
	</a>
      </span>
      <span class="previous-control">
	<a href="#">
	  <img src="../../assets/images/go-previous.png">
	</a>
      </span>
    </span>
    <span class="float-right">
      <span class="next-control">
	<a href="#">
	  <img src="../../assets/images/go-next.png">
	</a>
      </span>
      <span class="last-control">
	<a href="#">
	  <img src="../../assets/images/go-last.png">
	</a>
      </span>
    </span>
    <div class="slide-end">&nbsp;<br></div> <!-- hack -->
  </div>
<div class="content">
<section data-coord="modules.umt:1:0"><h1 data-coord="modules.umt:1:0">Modules</h1><section class="umt-slide" data-coord="modules.umt:4:0"><h2 data-coord="modules.umt:4:0">Overview</h2><ul data-coord="modules.umt:7:0"><li data-coord="modules.umt:7:0"><p data-coord="modules.umt:7:4">Need for modules.
</p></li><li data-coord="modules.umt:9:0"><p data-coord="modules.umt:9:4">Do-it-yourself modules.
</p></li><li data-coord="modules.umt:11:0"><p data-coord="modules.umt:11:4">Commonjs modules.
</p></li><li data-coord="modules.umt:13:0"><p data-coord="modules.umt:13:4">Asynchronous modules.
</p></li><li data-coord="modules.umt:15:0"><p data-coord="modules.umt:15:4">Concentrate on ES6 modules.
</p></li></ul></section><section class="umt-slide" data-coord="modules.umt:17:0"><h2 data-coord="modules.umt:17:0">Need for Modules</h2><ul data-coord="modules.umt:21:0"><li data-coord="modules.umt:21:0"><p data-coord="modules.umt:21:4">Tom writes a file <samp data-coord="modules.umt:21:22">math.js</samp> which includes a top-level <samp data-coord="modules.umt:21:59">sin()</samp>
function.
</p></li><li data-coord="modules.umt:24:0"><p data-coord="modules.umt:24:4">Jill writes a file <samp data-coord="modules.umt:24:23">morals.js</samp> which includes a top-level <samp data-coord="modules.umt:24:62">sin()</samp>
function.
</p></li><li data-coord="modules.umt:27:0"><p data-coord="modules.umt:27:4">How does program reuse the code from both files?
</p></li><li data-coord="modules.umt:29:0"><p data-coord="modules.umt:29:4">This is a problem with
<em data-coord="modules.umt:29:122"><a href="https://en.wikipedia.org/wiki/Programming_in_the_large_and_programming_in_the_small" data-coord="modules.umt:29:122">programming in the large</a></em>.
</p></li><li data-coord="modules.umt:33:0"><p data-coord="modules.umt:33:4">Common solution is to have programming language support
modules; for example Java has packages and modules (since
Java 9); C++ has namespaces.
</p></li><li data-coord="modules.umt:37:0"><p data-coord="modules.umt:37:4">Javascript had no support for modules until ES6.
</p></li></ul></section><section class="umt-slide" data-coord="modules.umt:40:0"><h2 data-coord="modules.umt:40:0">DIY Modules: IIFEs</h2><p data-coord="modules.umt:43:0">Code can be loaded and run in a browser using code like the following:
</p><pre><span class="hl opt">(</span><span class="hl kwa">function</span> <span class="hl opt">() {</span>
  <span class="hl kwa">const</span> constant <span class="hl opt">= ...;</span>
  <span class="hl kwa">let var</span> <span class="hl opt">= ...;</span>
  <span class="hl kwa">function</span> <span class="hl kwd">f1</span><span class="hl opt">(</span>element<span class="hl opt">) { ...</span> <span class="hl kwa">var</span> <span class="hl opt">...</span> constant <span class="hl opt">... }</span>
  <span class="hl kwa">function</span> <span class="hl kwd">f2</span><span class="hl opt">(</span>element<span class="hl opt">) { ...</span> <span class="hl kwd">f1</span><span class="hl opt">(); ...</span> <span class="hl kwa">var</span> <span class="hl opt">... }</span>

  <span class="hl slc">//code which is run on current browser document</span>
  <span class="hl kwd">f2</span><span class="hl opt">(</span>document<span class="hl opt">.</span><span class="hl kwd">getElementById</span><span class="hl opt">(</span><span class="hl str">&apos;shapes&apos;</span><span class="hl opt">));</span>
<span class="hl opt">})();</span></pre></section><section class="umt-slide" data-coord="modules.umt:58:0"><h2 data-coord="modules.umt:58:0">DIY Modules: Module Revealing Pattern</h2><pre><span class="hl kwa">const</span> math <span class="hl opt">= (</span><span class="hl kwa">function</span><span class="hl opt">() {</span>
  <span class="hl kwa">function</span> <span class="hl kwd">abs</span><span class="hl opt">() { ... }</span>
  <span class="hl opt">...</span>
  <span class="hl kwa">function</span> <span class="hl kwd">sin</span><span class="hl opt">() { ... }</span>
  <span class="hl opt">...</span>
  <span class="hl kwa">return</span> <span class="hl opt">{</span> abs<span class="hl opt">, ...,</span> sin<span class="hl opt">, ... };</span>
<span class="hl opt">})();</span>

<span class="hl kwa">const</span> morals <span class="hl opt">= (</span><span class="hl kwa">function</span><span class="hl opt">() {</span>
  <span class="hl kwa">function</span> <span class="hl kwd">doGood</span><span class="hl opt">() { ... }</span>
  <span class="hl opt">...</span>
  <span class="hl kwa">function</span> <span class="hl kwd">sin</span><span class="hl opt">() { ... }</span>
  <span class="hl opt">...</span>
  <span class="hl kwa">return</span> <span class="hl opt">{</span> doGood<span class="hl opt">, ...,</span> sin<span class="hl opt">, ... };</span>
<span class="hl opt">})();</span></pre></section><section class="umt-slide" data-coord="modules.umt:80:0"><h2 data-coord="modules.umt:80:0">Module Revealing Pattern Continued</h2><pre><span class="hl kwa">let</span> x <span class="hl opt">= ...;</span>
math<span class="hl opt">.</span><span class="hl kwd">sin</span><span class="hl opt">(</span>Math<span class="hl opt">.</span>PI<span class="hl kwc">/4);   /</span><span class="hl opt">/</span>ok
morals<span class="hl opt">.</span><span class="hl kwd">sin</span><span class="hl opt">(</span><span class="hl str">&apos;no more&apos;</span><span class="hl opt">);</span> <span class="hl slc">//ok</span>
math<span class="hl opt">.</span><span class="hl kwd">abs</span><span class="hl opt">(</span>x<span class="hl opt">*</span><span class="hl num">3</span><span class="hl opt">);</span>         <span class="hl slc">//ok</span>
morals<span class="hl opt">.</span><span class="hl kwd">abs</span><span class="hl opt">(...);</span>       <span class="hl slc">//error</span>
math<span class="hl opt">.</span><span class="hl kwd">doGood</span><span class="hl opt">();</span>         <span class="hl slc">//error</span></pre></section><section class="umt-slide" data-coord="modules.umt:93:0"><h2 data-coord="modules.umt:93:0">Different Startup Needs between Browser and Server</h2><p data-coord="modules.umt:96:0">JavaScript can only be doing one thing at a time:
</p><ul data-coord="modules.umt:98:0"><li data-coord="modules.umt:98:0"><p data-coord="modules.umt:98:4">When a web page is loaded into a browser:
</p><ul data-coord="modules.umt:100:0"><li data-coord="modules.umt:100:0"><p data-coord="modules.umt:100:8">It may load multiple remote scripts and other resources.
</p></li><li data-coord="modules.umt:102:0"><p data-coord="modules.umt:102:8">If scripts are loaded <strong data-coord="modules.umt:102:30">synchronously</strong>, then browser will
block during loading; this will result in unresponsive
web pages.
</p></li><li data-coord="modules.umt:106:0"><p data-coord="modules.umt:106:8">Hence for a browser, external resources must be loaded
<strong data-coord="modules.umt:106:71">asynchronously</strong>.
</p></li><li data-coord="modules.umt:109:0"><p data-coord="modules.umt:109:8">Resulted in <strong data-coord="modules.umt:109:20">Asynchronous Module Definitions</strong> AMD for
use in browsers.
</p></li><li data-coord="modules.umt:112:0"><p data-coord="modules.umt:112:8">Circular dependencies problematic.
</p></li></ul></li><li data-coord="modules.umt:114:0"><p data-coord="modules.umt:114:4">When a server-side application is started up, perfectly acceptable
to wait for resources to be loaded into application.  Hence
<strong data-coord="modules.umt:114:139">synchronous</strong> loading is acceptable.
</p><ul data-coord="modules.umt:118:0"><li data-coord="modules.umt:118:0"><p data-coord="modules.umt:118:9"><a href="https://en.wikipedia.org/wiki/CommonJS" data-coord="modules.umt:118:51">CommonJS</a>
specification (importing done using <samp data-coord="modules.umt:118:105">require()</samp> function).
</p></li><li data-coord="modules.umt:121:0"><p data-coord="modules.umt:121:9">Handles circular dependencies.
</p></li><li data-coord="modules.umt:123:0"><p data-coord="modules.umt:123:9">Emulated for browsers using server-side
packaging tools like <a href="https://webpack.js.org/" data-coord="modules.umt:123:106">webpack.</a>
</p></li></ul></li></ul></section><section class="umt-slide" data-coord="modules.umt:127:0"><h2 data-coord="modules.umt:127:0">ES6 Modules</h2><ul data-coord="modules.umt:130:0"><li data-coord="modules.umt:130:0"><p data-coord="modules.umt:130:4">Distinguish between JavaScript <strong data-coord="modules.umt:130:35">scripts</strong> versus JavaScript
<strong data-coord="modules.umt:130:67">modules</strong>.
</p></li><li data-coord="modules.umt:133:0"><p data-coord="modules.umt:133:4">Details of how a JavaScript program is recognized as a script
or module depends on the JavaScript environment.
</p></li><li data-coord="modules.umt:136:0"><p data-coord="modules.umt:136:4">Within JavaScript modules, <samp data-coord="modules.umt:136:31">import</samp> and <samp data-coord="modules.umt:136:44">export</samp> statements are
recognized.
</p></li><li data-coord="modules.umt:139:0"><p data-coord="modules.umt:139:4">Within JavaScript scripts, <samp data-coord="modules.umt:139:31">import</samp> and <samp data-coord="modules.umt:139:44">export</samp> statements are
not recognized and will cause a syntax error.
</p></li><li data-coord="modules.umt:142:0"><p data-coord="modules.umt:142:4">There can only be a single ES6 module per file and a ES6 module
is restricted to being defined within a single file.
</p></li><li data-coord="modules.umt:145:0"><p data-coord="modules.umt:145:4">The code within an ES6 module is always <samp data-coord="modules.umt:145:44">strict</samp>, as though there
was a <samp data-coord="modules.umt:145:80">"use strict";</samp> declaration at the start of the file.
</p></li></ul></section><section class="umt-slide" data-coord="modules.umt:149:0"><h2 data-coord="modules.umt:149:0">Exporting Symbols from an ES6 Module</h2><ul data-coord="modules.umt:152:0"><li data-coord="modules.umt:152:0"><p data-coord="modules.umt:152:4">All definitions within an ES6 module are private to that module
unless explicitly <samp data-coord="modules.umt:152:90">export</samp>'ed.
</p></li><li data-coord="modules.umt:155:0"><p data-coord="modules.umt:155:4">Can <samp data-coord="modules.umt:155:8">export</samp> each definition as it is made:
</p><pre>    <span class="hl kwa">export const</span> CONST <span class="hl opt">= ...</span>
    <span class="hl kwa">export class</span> Class <span class="hl opt">{ ... }</span>
    <span class="hl kwa">export function</span> <span class="hl kwd">fn</span><span class="hl opt">(...) { ... };</span></pre></li><li data-coord="modules.umt:163:0"><p data-coord="modules.umt:163:4">Alternately, can export a list of symbols:
</p><pre>    <span class="hl kwa">const</span> CONST <span class="hl opt">= ...</span>
    <span class="hl kwa">class</span> Class <span class="hl opt">{ ... };</span>
    <span class="hl kwa">function</span> <span class="hl kwd">fn</span><span class="hl opt">(...) { ... };</span>

    <span class="hl kwa">export</span> <span class="hl opt">{</span> CONST<span class="hl opt">,</span> Class<span class="hl opt">,</span> fn <span class="hl opt">};</span></pre></li></ul></section><section class="umt-slide" data-coord="modules.umt:173:0"><h2 data-coord="modules.umt:173:0">Importing Symbols from an ES6 Module</h2><ul data-coord="modules.umt:177:0"><li data-coord="modules.umt:177:0"><p data-coord="modules.umt:177:4">Can import features from an external module using an <samp data-coord="modules.umt:177:57">import</samp>
statement:
</p><pre>     <span class="hl kwa">import</span> <span class="hl opt">{</span> CONST<span class="hl opt">,</span> Class<span class="hl opt">,</span> fn <span class="hl opt">}</span>
       <span class="hl kwa">from</span> <span class="hl str">&apos;./modules/module.js&apos;</span><span class="hl opt">;</span>
     <span class="hl opt">...</span>
     <span class="hl opt">...</span> CONST <span class="hl opt">+</span> <span class="hl num">2</span> <span class="hl opt">...</span>
     <span class="hl opt">...</span> <span class="hl kwa">new</span> <span class="hl kwd">Class</span><span class="hl opt">() ...</span>
     <span class="hl opt">...</span> <span class="hl kwd">fn</span><span class="hl opt">() ...</span></pre></li><li data-coord="modules.umt:189:0"><p data-coord="modules.umt:189:4">Prefer to use a relative rather than absolute path to make
it easier to move stuff around.
</p></li></ul></section><section class="umt-slide" data-coord="modules.umt:192:0"><h2 data-coord="modules.umt:192:0">Importing Entire Module as an Object</h2><p data-coord="modules.umt:195:0">Can import entire module as an object:
</p><pre><span class="hl kwa">import</span> <span class="hl opt">*</span> as Module <span class="hl kwa">from</span> <span class="hl str">&apos;./modules/module.js&apos;</span><span class="hl opt">;</span>
<span class="hl opt">...</span>
<span class="hl opt">...</span> Module<span class="hl opt">.</span>CONST <span class="hl opt">+</span> <span class="hl num">2</span> <span class="hl opt">...</span>
<span class="hl opt">...</span> <span class="hl kwa">new</span> Module<span class="hl opt">.</span><span class="hl kwd">Class</span><span class="hl opt">() ...</span>
<span class="hl opt">...</span> Module<span class="hl opt">.</span><span class="hl kwd">fn</span><span class="hl opt">() ...</span></pre></section><section class="umt-slide" data-coord="modules.umt:205:0"><h2 data-coord="modules.umt:205:0">Default Exports</h2><ul data-coord="modules.umt:208:0"><li data-coord="modules.umt:208:0"><p data-coord="modules.umt:208:4">Can have a single default <samp data-coord="modules.umt:208:30">export</samp> per module:
</p><pre>    <span class="hl kwa">export default class</span> <span class="hl opt">{</span> <span class="hl slc">//anonymous class</span>
    <span class="hl opt">}</span></pre></li><li data-coord="modules.umt:215:0"><p data-coord="modules.umt:215:4">Import it giving it a name:
</p><pre>    <span class="hl kwa">import</span> ModuleClass <span class="hl kwa">from</span> <span class="hl str">&apos;./modules/module.js&apos;</span><span class="hl opt">;</span>

    <span class="hl opt">...</span> <span class="hl kwa">new</span> <span class="hl kwd">ModuleClass</span><span class="hl opt">() ...</span></pre></li></ul></section><section class="umt-slide" data-coord="modules.umt:224:0"><h2 data-coord="modules.umt:224:0">Renaming</h2><ul data-coord="modules.umt:227:0"><li data-coord="modules.umt:227:0"><p data-coord="modules.umt:227:4">Can use renaming to avoid naming conflicts:
</p><pre>     <span class="hl kwa">const</span> CONST <span class="hl opt">= ...;</span>
     <span class="hl kwa">import</span> <span class="hl opt">{</span> CONST as MODULE_CONST<span class="hl opt">,</span> Class<span class="hl opt">,</span> fn <span class="hl opt">}</span>
       <span class="hl kwa">from</span> <span class="hl str">&apos;./modules/module.js&apos;</span><span class="hl opt">;</span></pre></li><li data-coord="modules.umt:235:0"><p data-coord="modules.umt:235:4">Can use similar syntax for renaming in <samp data-coord="modules.umt:235:43">export</samp>
statements.
</p></li></ul></section><section class="umt-slide" data-coord="modules.umt:238:0"><h2 data-coord="modules.umt:238:0">ES6 Modules Pragmatics</h2><ul data-coord="modules.umt:241:0"><li data-coord="modules.umt:241:0"><p data-coord="modules.umt:241:4">Modules can use extension <samp data-coord="modules.umt:241:30">.mjs</samp>, but many tools do not
currently recognize that extension, so <samp data-coord="modules.umt:241:103">.js</samp> still commonly
used.
</p></li><li data-coord="modules.umt:245:0"><p data-coord="modules.umt:245:4">On server-side, nodejs recognizes <samp data-coord="modules.umt:245:38">*.mjs</samp> files as modules, but
can also recognize <samp data-coord="modules.umt:245:91">*.js</samp> files as modules provided there is a
<samp data-coord="modules.umt:245:139">"type": "module"</samp> declaration at the top-level within
<samp data-coord="modules.umt:245:198">package.json</samp>.
</p></li><li data-coord="modules.umt:250:0"><p data-coord="modules.umt:250:4">Within browser, modules can be pointed to using
<samp data-coord="modules.umt:250:56">&lt;script type="module"&gt;</samp>.
</p></li></ul></section><section class="umt-slide" data-coord="modules.umt:253:0"><h2 data-coord="modules.umt:253:0">Dynamic Module Loading</h2><ul data-coord="modules.umt:256:0"><li data-coord="modules.umt:256:0"><p data-coord="modules.umt:256:4">Dynamic imports possible by using asynchronous <samp data-coord="modules.umt:256:51">import()</samp> function.
</p></li><li data-coord="modules.umt:258:0"><p data-coord="modules.umt:258:4">Dynamic imports make it possible to import a module determined
dynamically or conditionally.
</p><pre data-coord="modules.umt:262:0">    &gt; Path = 1
    1
    &gt; (async function() {
        Path = await import('path');
      })()
    Promise { &lt;pending&gt; }
    &gt; Path
    [Module] {
      _makeLong: [Function: toNamespacedPath],
     ....
    }
    &gt; 
</pre></li></ul></section><section class="umt-slide" data-coord="modules.umt:276:0"><h2 data-coord="modules.umt:276:0">Semantic Versioning</h2><p data-coord="modules.umt:279:0"><em data-coord="modules.umt:279:22"><a href="http://semver.org/" data-coord="modules.umt:279:22">Semantic Versioning</a></em> attempts to avoid
<em data-coord="modules.umt:279:111"><a href="https://en.wikipedia.org/wiki/Dependency_hell" data-coord="modules.umt:279:111">dependency hell</a></em>.
It uses a 3 part version number: <em data-coord="modules.umt:279:163">M.m.r</em> where each part is a integer
without leading zeros.
</p><dl data-coord="modules.umt:284:0"><dt data-coord="modules.umt:284:2">Revision Number <em data-coord="modules.umt:284:16">r</em></dt><dd data-coord="modules.umt:285:0"><p data-coord="modules.umt:285:4">Incremented for bug fixes.
</p></dd><dt data-coord="modules.umt:287:2">Minor Version <em data-coord="modules.umt:287:14">m</em></dt><dd data-coord="modules.umt:288:0"><p data-coord="modules.umt:288:4">Incremented for added functionality which is backward compatible.
</p></dd><dt data-coord="modules.umt:290:2">Major Version <em data-coord="modules.umt:290:14">M</em></dt><dd data-coord="modules.umt:291:0"><p data-coord="modules.umt:291:4">Incremented for incompatible changes which are not backward
compatible.
</p></dd></dl></section><section class="umt-slide" data-coord="modules.umt:295:0"><h2 data-coord="modules.umt:295:0">References</h2><ul data-coord="modules.umt:298:0"><li data-coord="modules.umt:298:0"><p data-coord="modules.umt:298:4"><em data-coord="modules.umt:298:81"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules" data-coord="modules.umt:298:81">MDN JavaScript Modules</a></em>.
</p></li><li data-coord="modules.umt:301:0"><p data-coord="modules.umt:301:4"><em data-coord="modules.umt:301:63"><a href="https://hacks.mozilla.org/2015/08/es6-in-depth-modules/" data-coord="modules.umt:301:63">ES6 in
    Depth: Modules</a></em> by Jason Orendorff.
</p></li><li data-coord="modules.umt:304:0"><p data-coord="modules.umt:304:4"><a href="https://exploringjs.com/es6/ch_modules.html" data-coord="modules.umt:304:51">Modules</a>
chapter in <em data-coord="modules.umt:304:74">Exploring ES6</em> by Dr, Axel Rauschmayer.
</p></li></ul></section></section>
</div> <!-- #content -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="../../assets/scripts/slide-controls.js"></script>
<script src="../../assets/scripts/loginAction.js"></script>
</body>
</html>
